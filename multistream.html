<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Stream Video Layout</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.10/hls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1b1b1b 0%, #444444 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .sidebar {
            width: 280px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            transition: transform 0.3s ease;
            scrollbar-width: thin;
            scrollbar-color: rgba(100, 181, 246, 0.5) transparent;
        }
        
        /* Webkit (Chrome, Safari, etc.) */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background-color: rgba(100, 181, 246, 0.3);
            border-radius: 4px;
            border: 2px solid transparent;
            background-clip: padding-box;
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover {
            background-color: rgba(100, 181, 246, 0.5);
        }

        .sidebar h2 {
            margin-bottom: 15px;
            font-size: 1.5rem;
            text-align: center;
            color: #64b5f6;
        }
        
        .search-container {
            margin-bottom: 15px;
            padding: 0 5px;
        }
        
        .channel-search {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            outline: none;
        }
        
        .channel-search:focus {
            border-color: #64b5f6;
            box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.2);
        }
        
        .channel-search::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .channel-item {
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            margin-bottom: 5px;
            position: relative;
        }
        
        .channel-item.dropdown-item {
            background: transparent;
            margin: 4px 0;
            padding: 10px 15px;
            border: 1px solid transparent;
            transition: all 0.2s ease;
        }
        
        .channel-item.dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(100, 181, 246, 0.1);
        }
        
        .dropdown-wrapper.active .channel-item.dropdown-item {
            background: rgba(100, 181, 246, 0.1);
            border-color: rgba(100, 181, 246, 0.2);
        }
        
        .channel-item > div {
            width: 100%;
        }
        
        .dropdown-wrapper {
            width: 100%;
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            display: none;
            position: relative;
            background: transparent;
            width: calc(100% - 10px);
            max-width: 100%;
            z-index: 10;
            margin: 5px 0 5px 10px;
            max-height: 300px;
            overflow-y: auto;
            overflow-x: hidden; /* Prevent horizontal scrollbar */
            padding-left: 10px;
            border-left: 2px solid rgba(100, 181, 246, 0.2);
            border-radius: 0 0 0 8px;
            box-sizing: border-box;
            word-wrap: break-word; /* Ensure long text wraps */
        }
        
        .dropdown-wrapper.active .dropdown-content {
            display: block;
        }
        
        .dropdown-item {
            padding: 8px 10px;
            margin: 2px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
            border-radius: 4px;
            cursor: pointer;
            color: #e0e0e0;
            background: transparent;
            font-size: 0.9em;
            border: 1px solid transparent;
            max-width: 100%;
            box-sizing: border-box;
            white-space: normal; /* Allow text to wrap */
            word-break: break-word; /* Break long words if needed */
        }
        
        .dropdown-item:last-child {
            border-bottom: none;
        }
        
        .dropdown-item:hover {
            background: rgba(100, 181, 246, 0.1);
            transform: translateX(3px);
            color: #fff;
            border-color: rgba(100, 181, 246, 0.2);
        }
        
        .dropdown-arrow {
            transition: transform 0.3s ease;
            margin-left: 5px;
            display: inline-block;
        }
        
        .dropdown-wrapper.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .channel-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .channel-item.active {
            background: rgba(100, 181, 246, 0.3);
            border-color: #64b5f6;
        }

        .channel-name {
            font-weight: 500;
        }

        .channel-type {
            font-size: 0.8rem;
            opacity: 0.7;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .video-grid {
            flex: 1;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            grid-auto-rows: 0;
            grid-template-rows: repeat(2, minmax(0, 1fr));
            grid-template-areas: 
                "top-left top-right"
                "bottom-left bottom-right";
            gap: 15px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            height: calc(100% - 70px);
            min-height: 0;
            min-width: 0;
            box-sizing: border-box;
            width: auto;
            margin: 0 auto;
            justify-content: center;
        }
        
        #stream-0 { grid-area: top-left; }
        #stream-1 { grid-area: top-right; }
        #stream-2 { grid-area: bottom-left; }
        #stream-3 { grid-area: bottom-right; }

        .video-grid.grid-1 { grid-template-columns: 1fr; }
        .video-grid.grid-2 { grid-template-columns: repeat(2, 1fr); }
        .video-grid.grid-3 { grid-template-columns: repeat(2, 1fr); grid-template-rows: 1fr 1fr; }
        .video-grid.grid-3 .video-container:first-child { grid-column: span 2; }
        .video-grid.grid-4 { grid-template-columns: repeat(2, 1fr); }
        .video-grid.grid-5 { grid-template-columns: repeat(3, 1fr); grid-template-rows: 1fr 1fr; }
        .video-grid.grid-5 .video-container:nth-child(1),
        .video-grid.grid-5 .video-container:nth-child(2) { grid-row: span 2; }

        /* Focus mode styles */
        .video-grid.focus-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            background: linear-gradient(135deg, #1b1b1b 0%, #444444 100%);
            padding: 20px;
            margin: 0;
            height: 100vh;
            width: 100vw;
            grid-template-columns: repeat(2, 1fr) !important;
            grid-template-rows: repeat(2, 1fr) !important;
            gap: 10px;
            box-sizing: border-box;
        }
        
        .video-grid.focus-mode .video-container {
            height: 100% !important;
            width: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            border: 2px solid #333;
            box-sizing: border-box;
        }
        
        .video-grid.focus-mode video,
        .video-grid.focus-mode iframe {
            width: 100% !important;
            height: 100% !important;
            object-fit: contain;
        }
        
        /* Exit focus mode button */
        .exit-focus-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1001;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 22px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            transform-origin: center;
            opacity: 0;
            visibility: hidden;
            line-height: 1;
            padding: 0 0 2px 0; /* Slight bottom padding to visually center the X */
            margin: 0;
            box-sizing: border-box;
        }
        
        .exit-focus-btn.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .exit-focus-btn:hover {
            background: rgba(255, 0, 0, 0.9);
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        .video-grid.grid-6 { grid-template-columns: repeat(3, 1fr); }

        .video-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 0; /* Will be set by JavaScript */
            height: 100%;
            position: relative;
            box-sizing: border-box;
            aspect-ratio: 16/9;
        }
        
        .video-container > video,
        .video-container > iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            border: none;
        }

        .video-container.focused {
            border-color: #64b5f6;
            box-shadow: 0 8px 30px rgba(100, 181, 246, 0.4);
            transform: scale(1.02);
            z-index: 10;
        }

        .video-container.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
        }

        .empty-text {
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            width: 100%;
            padding: 10px 0;
            white-space: nowrap;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        video, iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
            background: black;
            aspect-ratio: 16/9;
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(0deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 30%);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 15px;
            box-sizing: border-box;
            z-index: 2;
            pointer-events: none;
        }
        
        .video-container.empty .video-overlay {
            display: none;
        }
        
        .video-container:not(.empty) .video-overlay {
            opacity: 1;
            pointer-events: none; /* Let clicks pass through to the video */
        }
        
        .video-container:not(.empty) .video-controls {
            pointer-events: auto; /* But keep controls clickable */
        }

        .video-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .video-container:hover .video-controls {
            opacity: 1;
            transform: translateY(0);
        }

        .control-btn {
            background: rgba(0, 0, 0, 0.8);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: rgba(100, 181, 246, 0.8);
            transform: scale(1.05);
        }

        .bottom-controls {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .stream-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .stream-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            min-width: 50px;
        }

        .stream-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .stream-btn.active {
            background: #64b5f6;
            border-color: #64b5f6;
            box-shadow: 0 4px 15px rgba(100, 181, 246, 0.4);
        }

        .stream-btn.has-content {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4caf50;
        }

        .layout-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .layout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .layout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .pip-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(100, 181, 246, 0.9);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .pip-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }

        .video-container.loading::before {
            content: "Loading...";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 6px;
            animation: pulse 1.5s infinite;
            z-index: 5;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: absolute;
                top: 0;
                left: 0;
                z-index: 100;
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .video-grid {
                /* Keep 2x2 grid on mobile but make it more compact */
                padding: 10px;
                gap: 10px;
                height: auto;
                min-height: calc(100% - 70px);
            }

            .video-container {
                min-height: 150px; /* Reduced from 200px to fit better on mobile */
            }

            .bottom-controls {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <h2>Available Channels</h2>
            <div class="search-container">
                <input type="text" id="channelSearch" placeholder="Search channels..." class="channel-search">
            </div>
            <div class="channel-list" id="channelList">
                <!-- Sample channels will be populated by JavaScript -->
            </div>
        </div>

        <div class="main-content">
            <div class="video-grid grid-1" id="videoGrid">
                <!-- Video containers will be dynamically created -->
            </div>

            <div class="bottom-controls">
                <div class="stream-selector">
                    <span>Focus Stream:</span>
                    <div id="streamButtons"></div>
                </div>
                <div class="layout-controls">
                    <button class="layout-btn" onclick="clearAllStreams()">Clear All</button>
                    <button class="layout-btn" id="sidebarToggle" onclick="toggleSidebar()">Focus Mode</button>
                </div>
            </div>
        </div>
    </div>

    <div class="pip-indicator" id="pipIndicator">
        Picture-in-Picture Active
    </div>
    
    <div class="exit-focus-btn" id="exitFocusBtn" title="Exit Focus Mode">×</div>

    <script>
        // Sample channel data
        const channels = [
            { name: "ABC", url: "https://kleanembed.online/embed/wffwehg9yklo7k3dmabqxi70sbws5w4q", type: "iframe" },
            { name: "Bein Sports", url: "https://kleanembed.online/embed/afdb73c451239369681c5e34207bf17a", type: "iframe" },
            { name: "Cartoon Network", url: "https://kleanembed.online/embed/j7frlCr9theTHiPhistuSPInuchosawE", type: "iframe" },
            { name: "CBS", url: "https://fl3.moveonjoy.com/CBS_News/index.m3u8", type: "m3u8" },
            { name: "CBS Golazo", url: "https://dai.google.com/linear/hls/event/GxrCGmwST0ixsrc_QgB6qw/master.m3u8", type: "m3u8" },
            { name: "CBS Sports", url: "https://fl3.moveonjoy.com/CBS_SPORTS_NETWORK/index.m3u8", type: "m3u8" },
            { name: "Channel 5 ⭐", url: "https://daddylive.dad/embed/stream-355.php", type: "iframe" },
            { name: "Dragon Ball Z", url: "https://kleanembed.online/embed/pH1yC6tG9rU2pL5zQ0nH3sI8wB4tFi", type: "iframe" },
            { name: "ESPN", url: "https://kleanembed.online/embed/tgcyutly3zujtd3bgef8nevyy5v5n301", type: "iframe" },
            { name: "ESPN 2", url: "https://kleanembed.online/embed/zL7vB5kT3aO1gR8iX4nF6wP9dY2uHs", type: "iframe" },
            { name: "ESPN U", url: "https://kleanembed.online/embed/oI3uC8jF6yP2bW0zQ9nA5sM7lX1eRt", type: "iframe" },
            { name: "ESPN Deportes ⭐", url: "https://thedaddy.to/embed/stream-375.php", type: "iframe" },
            { name: "ESPN News", url: "https://kleanembed.online/embed/hN9eS4rZ1wM7fC3vJ0aX8pG2yQ5bUi", type: "iframe" },
            { name: "ACCN", url: "https://fl3.moveonjoy.com/ACC_NETWORK/index.m3u8", type: "m3u8" },
            { name: "Big 10", url: "https://fl3.moveonjoy.com/BIG_TEN_NETWORK/tracks-v1a1/mono.ts.m3u8", type: "m3u8" },
            { name: "SECN", url: "https://fl3.moveonjoy.com/SEC_NETWORK/index.m3u8", type: "m3u8" },
            { name: "Fanduel TV", url: "https://fl3.moveonjoy.com/PAC_12/index.m3u8", type: "m3u8" },
            { name: "Food Network", url: "https://fl3.moveonjoy.com/FOOD_NETWORK/index.m3u8", type: "m3u8" },
            { name: "Fox Deportes ⭐", url: "https://antenaplanet.store/foxdeportes.php", type: "iframe" },
            { name: "Fox Soccer plus ", url: "https://kleanembed.online/embed/trAbIqUqIYicRlcHuri1LwenehacrowU", type: "iframe" },
            { name: "FS1", url: "https://fl3.moveonjoy.com/FOX_Sports_1/index.m3u8", type: "m3u8" },
            { name: "FS2", url: "https://kleanembed.online/embed/9bfdo7kxd45sst08hbuh6rwhkykmitwb", type: "iframe" },
            { name: "fuboTV", url: "https://apollo.production-public.tubi.io/live/ac-fubo.m3u8", type: "m3u8" },
            { name: "ION", url: "https://fl3.moveonjoy.com/ION_TV/index.m3u8", type: "m3u8" },
            { name: "laligatv", url: "https://kleanembed.online/embed/pajip6maru1rlcoz1qizebitocof4aP7", type: "iframe" },
            { name: "NBA TV", url: "https://kleanembed.online/embed/T1ag4xopruwaFuThuwUS7lNI4HeTucot", type: "iframe" },
            { name: "NFL Network", url: "https://fl3.moveonjoy.com/NFL_NETWORK/index.m3u8", type: "m3u8" },
            { name: "NFL Redzone", url: "https://fl3.moveonjoy.com/NFL_RedZone/index.m3u8", type: "m3u8" },
            { name: "NHL Network", url: "https://fl3.moveonjoy.com/NHL_NETWORK/index.m3u8", type: "m3u8" },
            { name: "Nicktoons", url: "https://fl1.moveonjoy.com/NICKTOONS/tracks-v1a1/mono.m3u8", type: "m3u8" },
            { name: "Premier Sports 1", url: "https://kleanembed.online/embed/aE5dT9yH2uJ8gP1zWn7fK4oL6mV3cB", type: "iframe" },
            { name: "Premier Sports 2", url: "https://kleanembed.online/embed/sY1bX6cA8rM3wQ7iN9jV2pE5hU0lGf", type: "iframe" },
            { name: "TBS", url: "https://kleanembed.online/embed/prLbr6tHLvozlcehLbrIb5crU2awoklC", type: "iframe" },
            { name: "TNT", url: "https://kleanembed.online/embed/940ecd921be2f888c443b67d0b40598b", type: "iframe" },
            { name: "TruTV", url: "https://kleanembed.online/embed/63809a66e263a940dfc7bc4f429907d6", type: "iframe" },
            { name: "USA", url: "https://kleanembed.online/embed/prObIniBoc7ltizEGEvUSpLstaClmlbr", type: "iframe" },
            { name: "Tenis channel", url: "https://kleanembed.online/embed/671644cddc7ee3158d3291c88ec8a1a1", type: "iframe" },
            { 
                name: "MLB TV", 
                type: "dropdown",
                options: [
                    { name: "Stream 1", url: "https://streamscenter.online/embed/ch15.php", type: "iframe" },
                    { name: "Stream 2", url: "https://streamscenter.online/embed/ch16.php", type: "iframe" },
                    { name: "Stream 3", url: "https://streamscenter.online/embed/ch17.php", type: "iframe" },
                    { name: "Stream 4", url: "https://streamscenter.online/embed/ch18.php", type: "iframe" },
                    { name: "Stream 5", url: "https://streamscenter.online/embed/ch19.php", type: "iframe" },
                    { name: "Stream 6", url: "https://streamscenter.online/embed/ch20.php", type: "iframe" },
                    { name: "Stream 7", url: "https://streamscenter.online/embed/ch21.php", type: "iframe" },
                    { name: "Stream 8", url: "https://streamscenter.online/embed/ch22.php", type: "iframe" },
                    { name: "Stream 9", url: "https://streamscenter.online/embed/ch23.php", type: "iframe" },
                    { name: "Stream 10", url: "https://streamscenter.online/embed/ch24.php", type: "iframe" },
                    { name: "Stream 11", url: "https://streamscenter.online/embed/ch25.php", type: "iframe" },
                    { name: "Stream 12", url: "https://streamscenter.online/embed/ch26.php", type: "iframe" },
                    { name: "Stream 13", url: "https://streamscenter.online/embed/ch27.php", type: "iframe" },
                    { name: "Stream 14", url: "https://streamscenter.online/embed/ch28.php", type: "iframe" },
                    { name: "Stream 15", url: "https://streamscenter.online/embed/ch29.php", type: "iframe" }
                ]
            },
            { name: "MLB Network", url: "https://kleanembed.online/embed/dd2b541cd3c0f5e547f9a7cdd4c2cb06", type: "iframe" },
            { 
                name: "DAZN", 
                type: "dropdown",
                options: [
                    { name: "Dazn 1⭐", url: "https://antenaplanet.store/dazn1de.php", type: "iframe" },
                    { name: "Dazn 2⭐", url: "https://antenaplanet.store/dazn2de.php", type: "iframe" },
                    { name: "Dazn 1 spanish⭐", url: "https://thedaddy.to/embed/stream-445.php", type: "iframe" },
                    { name: "Dazn 2 spanish⭐", url: "https://thedaddy.to/embed/stream-446.php", type: "iframe" },
                    { name: "Dazn 3 spanish⭐", url: "https://thedaddy.to/embed/stream-447.php", type: "iframe" },
                    { name: "Dazn 4 spanish⭐", url: "https://thedaddy.to/embed/stream-448.php", type: "iframe" },
                    { name: "Dazn f1⭐", url: "https://thedaddy.to/embed/stream-537.php", type: "iframe" },
                    { name: "Dazn laliga⭐", url: "https://thedaddy.to/embed/stream-538.php", type: "iframe" },
                    { name: "Dazn laliga 2⭐", url: "https://thedaddy.to/embed/stream-43.php", type: "iframe" },
                    { name: "Dazn Portugal⭐", url: "https://thedaddy.to/embed/stream-918.php", type: "iframe" },
                    { name: "Dazn Portugal 2⭐", url: "https://antenaplanet.store/dazn4pt.php", type: "iframe" },
                    { name: "Dazn Portugal UK", url: "https://kleanembed.online/embed/29f80fe360ea09758cda99ec2eb61fd2", type: "iframe" },
                ]
            },
             
            { 
                name: "Fanduel sports", 
                type: "dropdown",
                options: [
                    { name: "Fanduel 1⭐", url: "https://daddylive.dad/embed/stream-896.php", type: "iframe" },
                    { name: "Fanduel 2⭐", url: "https://daddylive.dad/embed/stream-902.php", type: "iframe" },
                    { name: "Fanduel 3⭐", url: "https://daddylive.dad/embed/stream-905.php", type: "iframe" },
                ]
            },
            { 
                name: "FIFA", 
                type: "dropdown",
                options: [
                    { name: "FIFA", url: "https://a62dad94.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWV1X0ZJRkFQbHVzRW5nbGlzaF9ITFM/playlist.m3u8", type: "m3u8" },
                    { name: "Germany", url: "https://4397879b.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWRlX0ZJRkFQbHVzR2VybWFuX0hMUw/playlist.m3u8", type: "m3u8" },
                    { name: "France", url: "https://37b4c228.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWZyX0ZJRkFQbHVzRnJlbmNoX0hMUw/playlist.m3u8", type: "m3u8" },
                    { name: "Italy", url: "https://5d95f7d7.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWl0X0ZJRkFQbHVzSXRhbGlhbl9ITFM/playlist.m3u8", type: "m3u8" },
                    { name: "Spain", url: "https://d63fabad.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWVzX0ZJRkFQbHVzU3BhbmlzaF9ITFM/playlist.m3u8", type: "m3u8" },
                ]
            },
            { 
                name: "NBC", 
                type: "dropdown",
                options: [
                    { name: "NBC", url: "https://a62dad94.wurl.com/master/f36d25e7e52f1ba8d7e56eb859c636563214f541/UmFrdXRlblRWLWV1X0ZJRkFQbHVzRW5nbGlzaF9ITFM/playlist.m3u8", type: "m3u8" },
                    { name: "NBC philadelphia", url: "https://kleanembed.online/embed/b46c64f505d77d9c3ba37c2f3037f0f3", type: "iframe" },
                    { name: "NBC chicago⭐", url: "https://thedaddy.to/embed/stream-776.php", type: "iframe" },
                    { name: "NBC california⭐", url: "https://thedaddy.to/embed/stream-755.php", type: "iframe" },
                    { name: "NBC washington⭐", url: "https://thedaddy.to/embed/stream-778.php", type: "iframe" },
                    { name: "NBC bayarea", url: "https://kleanembed.online/embed/5411235d278f9abfce9db28c140374d5", type: "iframe" },
                    { name: "NBC boston⭐", url: "https://thedaddy.to/embed/stream-754.php", type: "iframe" },
                    { name: "NBC golf⭐", url: "https://thedaddy.to/embed/stream-318.php", type: "iframe" },
                ]
            },
            { 
                name: "TNT SPORTS", 
                type: "dropdown",
                options: [
                    { name: "Server 1", url: "https://kleanembed.online/embed/FrofUdRljoCLdruGUdR295IfisTlsW1w", type: "iframe" },
                    { name: "Server 2", url: "https://kleanembed.online/embed/c5phutHUkothlwRudRO8rosaS3B64ini", type: "iframe" },
                    { name: "Server 3", url: "https://kleanembed.online/embed/SodrItO5WeQeFraDRoQa900eSw68I9LG", type: "iframe" },
                    { name: "Server 4", url: "https://kleanembed.online/embed/8esiM7BRatIQ3cAdaxes34tesIbrOpOp", type: "iframe" },
                ]
            },
            { 
                name: "TSN", 
                type: "dropdown",
                options: [
                    { name: "tsn1", url: "https://fl5.moveonjoy.com/TSN_1/index.m3u8", type: "m3u8" },
                    { name: "tsn2", url: "https://fl5.moveonjoy.com/TSN_2/index.m3u8", type: "m3u8" },
                    { name: "tsn3", url: "https://fl5.moveonjoy.com/TSN_3/index.m3u8", type: "m3u8" },
                    { name: "tsn4", url: "https://fl5.moveonjoy.com/TSN_4/index.m3u8", type: "m3u8" },
                    { name: "tsn5", url: "https://fl5.moveonjoy.com/TSN_5/index.m3u8", type: "m3u8" },
                ]
            },
            { 
                name: "Sky sports", 
                type: "dropdown",
                options: [
                    { name: "skysports", url: "https://kleanembed.online/embed/kl11IkOsWATR8duxiWrOyiprERl2hLx4", type: "m3u8" },
                    { name: "skysports action", url: "https://kleanembed.online/embed/wra2wlraTrewrAwohlsiCr0kUpHlswuc", type: "m3u8" },
                    { name: "skysports bundesliga", url: "https://kleanembed.online/embed/wramespicr0swivlb9hAserldOthofas", type: "m3u8" },
                    { name: "skysports cricket", url: "https://kleanembed.online/embed/j5ru6icHofROsespidec64w0s7lgo8ot", type: "m3u8" },
                    { name: "skysports football", url: "https://kleanembed.online/embed/zuw3aYlboraPaStUP4o5ropHlbrospev", type: "m3u8" },
                    { name: "skysports f1", url: "https://kleanembed.online/embed/888520f36cd94c5da4c71fddc1a5fc9b", type: "m3u8" },
                    { name: "skysports golf", url: "https://kleanembed.online/embed/juDiYAyaWljAtH55usw2sWogINI49kIY", type: "m3u8" },
                    { name: "skysports main event", url: "https://kleanembed.online/embed/4reStAcaHuraStIc3o7rOdRAprEy2glB", type: "m3u8" },
                    { name: "skysports mix", url: "https://kleanembed.online/embed/phAjl4we7iw0agitOpro8Rlcrotrufr", type: "m3u8" },
                    { name: "skysports motogp", url: "https://kleanembed.online/embed/1c6f53f565af34b3099d28adba983591", type: "m3u8" },
                    { name: "skysports news", url: "https://kleanembed.online/embed/ZiProtriRlspiriBrI2oProjohAfretA", type: "m3u8" },
                    { name: "skysports premier league", url: "https://kleanembed.online/embed/swapr5jlpHidrlfR65ofRi8a0itHI6oc", type: "m3u8" },
                    { name: "skysports racing", url: "https://kleanembed.online/embed/x5Dodrl6Ro21RUprudEQAFRUTEfLPhec", type: "m3u8" },
                
                ]
            },
        ];

        let activeStreams = [];
        let focusedStream = 0;
        let currentLayout = 1;

        // Initialize the application
        function init() {
            populateChannelList();
            createVideoContainers();
            createStreamButtons();
            updateLayout();
        }

        function populateChannelList() {
            const channelList = document.getElementById('channelList');
            channels.forEach((channel, index) => {
                const channelItem = document.createElement('div');
                channelItem.className = 'channel-item';
                
                if (channel.type === 'dropdown') {
                    // Create dropdown for MLB TV
                    const wrapperId = `dropdown-${index}`;
                    channelItem.innerHTML = `
                        <div class="dropdown-wrapper" id="${wrapperId}">
                            <div class="dropdown-header">
                                <span class="channel-name">${channel.name}</span>
                                <span class="dropdown-arrow">▼</span>
                            </div>
                            <div class="dropdown-content">
                                ${channel.options.map((option, i) => `
                                    <div class="dropdown-item" data-channel='${JSON.stringify(option).replace(/'/g, '&#39;')}'>
                                        <span>${option.name}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    
                    // Add click handler for dropdown header
                    const header = channelItem.querySelector('.dropdown-header');
                    header.onclick = (e) => {
                        e.stopPropagation();
                        const wrapper = document.getElementById(wrapperId);
                        wrapper.classList.toggle('active');
                    };
                } else {
                    // Regular channel item
                    channelItem.innerHTML = `
                        <span class="channel-name">${channel.name}</span>
                    `;
                    channelItem.onclick = () => addChannelToStream(channel);
                }
                
                channelList.appendChild(channelItem);
            });

            // Add click handler for dropdown items
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const channel = JSON.parse(item.dataset.channel.replace(/&#39;/g, "'"));
                    addChannelToStream(channel);
                    // Close the dropdown after selection
                    item.closest('.dropdown-wrapper').classList.remove('active');
                });
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.dropdown-wrapper')) {
                    document.querySelectorAll('.dropdown-wrapper').forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });
                }
            });
        }

        function createVideoContainers() {
            const videoGrid = document.getElementById('videoGrid');
            videoGrid.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {  // Only create 4 stream containers
                const container = document.createElement('div');
                container.className = 'video-container empty';
                container.id = `stream-${i}`;
                container.innerHTML = `
                    <div class="empty-text">Stream ${i + 1}</div>
                    <div class="video-overlay">
                        <div class="video-controls">
                            <button class="control-btn" onclick="event.stopPropagation(); removeStream(${i})">Remove</button>
                        </div>
                    </div>
                `;
                videoGrid.appendChild(container);
            }
        }

        function createStreamButtons() {
            const streamButtons = document.getElementById('streamButtons');
            streamButtons.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {  // Only create 4 stream buttons
                const button = document.createElement('button');
                button.className = 'stream-btn';
                button.textContent = i + 1;
                button.onclick = () => focusStream(i);
                streamButtons.appendChild(button);
            }
            updateStreamButtons();
        }

        function addChannelToStream(channel) {
            // Check if channel is already active
            const isChannelActive = activeStreams.some(stream => stream && stream.url === channel.url);
            if (isChannelActive) {
                alert('This channel is already being streamed.');
                return;
            }

            // Find first empty stream slot
            let targetSlot = -1;
            for (let i = 0; i < 4; i++) {  // Only check 4 slots
                if (!activeStreams[i]) {
                    targetSlot = i;
                    break;
                }
            }

            if (targetSlot === -1) {
                alert('Maximum of 4 streams allowed. Remove a stream first.');
                return;
            }

            const container = document.getElementById(`stream-${targetSlot}`);
            container.classList.remove('empty');

            // Clear existing content
            container.innerHTML = `
                <div class="video-overlay">
                    <div class="video-controls">
                        <button class="control-btn" onclick="removeStream(${targetSlot})">Remove</button>
                    </div>
                </div>
            `;

            if (channel.type === 'm3u8') {
                const video = document.createElement('video');
                video.controls = true;
                video.muted = true;
                video.autoplay = true;
                video.style.width = '100%';
                video.style.height = '100%';
                
                // Picture-in-Picture support removed

                container.insertBefore(video, container.querySelector('.video-overlay'));

                // Initialize HLS.js for m3u8 streams
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(channel.url);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        // Loading complete
                    });
                    
                    // Store HLS instance for cleanup
                    video.hlsInstance = hls;
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = channel.url;
                    video.addEventListener('loadedmetadata', () => {
                        // Loading complete
                    });
                }
            } else if (channel.type === 'iframe') {
                const iframe = document.createElement('iframe');
                iframe.src = channel.url;
                iframe.allowFullscreen = true;
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                
                iframe.onload = () => {
                    container.classList.remove('loading');
                };
                
                container.insertBefore(iframe, container.querySelector('.video-overlay'));
            }

            activeStreams[targetSlot] = channel;
            updateLayout();
            updateStreamButtons();
            focusStream(targetSlot);
        }

        function removeStream(index) {
            const container = document.getElementById(`stream-${index}`);
            const video = container.querySelector('video');
            
            // Clean up HLS instance if it exists
            if (video && video.hlsInstance) {
                video.hlsInstance.destroy();
            }
            
            container.className = 'video-container empty';
            container.innerHTML = `
                <div class="empty-text">Stream ${index + 1}</div>
                <div class="video-overlay">
                    <div class="video-controls">
                        <button class="control-btn" onclick="event.stopPropagation(); removeStream(${index})">Remove</button>
                    </div>
                </div>
            `;
            
            activeStreams[index] = null;
            updateLayout();
            updateStreamButtons();
            
            // Reset focus if the removed stream was focused
            if (focusedStream === index) {
                focusedStream = 0;
                focusStream(0);
            }
        }

        function focusStream(index) {
            // Mute all videos first
            document.querySelectorAll('video').forEach(video => {
                video.muted = true;
            });
            
            // Remove focus from all streams
            document.querySelectorAll('.video-container').forEach(container => {
                container.classList.remove('focused');
            });
            
            // Update stream button states
            document.querySelectorAll('.stream-btn').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            // Focus and unmute the selected stream
            const targetContainer = document.getElementById(`stream-${index}`);
            if (targetContainer && !targetContainer.classList.contains('empty')) {
                targetContainer.classList.add('focused');
                const video = targetContainer.querySelector('video');
                if (video) {
                    video.muted = false;
                }
                targetContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
            
            focusedStream = index;
        }

        function updateVideoSizes() {
            const containers = document.querySelectorAll('.video-container');
            if (containers.length === 0) return;
            
            // Get the height of the first container (all should be the same)
            const containerHeight = containers[0].offsetHeight;
            // Calculate width based on 16:9 aspect ratio
            const containerWidth = (containerHeight * 16) / 9;
            
            // Apply the width to all containers
            containers.forEach(container => {
                container.style.width = `${containerWidth}px`;
            });
        }
        
        function updateLayout() {
            // Always show all 4 containers in their fixed positions
            document.querySelectorAll('.video-container').forEach((container, index) => {
                container.style.display = 'block';
            });
            
            // Update video sizes after a short delay to ensure layout is calculated
            setTimeout(updateVideoSizes, 10);
        }
        
        // Update sizes on window resize
        window.addEventListener('resize', updateVideoSizes);
        // Initial update
        window.addEventListener('load', updateVideoSizes);

        function updateStreamButtons() {
            document.querySelectorAll('.stream-btn').forEach((btn, index) => {
                if (activeStreams[index]) {
                    btn.classList.add('has-content');
                } else {
                    btn.classList.remove('has-content');
                }
            });
        }

        function enablePiP(index) {
            const container = document.getElementById(`stream-${index}`);
            const video = container.querySelector('video');
            
            if (video && 'pictureInPictureEnabled' in document) {
                video.requestPictureInPicture().catch(err => {
                    console.log('PiP not supported or failed:', err);
                    alert('Picture-in-Picture is not supported for this stream or browser.');
                });
            } else {
                alert('Picture-in-Picture is only supported for video streams, not iframes.');
            }
        }

        function showPiPIndicator() {
            const indicator = document.getElementById('pipIndicator');
            indicator.classList.add('show');
        }

        function hidePiPIndicator() {
            const indicator = document.getElementById('pipIndicator');
            indicator.classList.remove('show');
        }

        function clearAllStreams() {
            for (let i = 0; i < 4; i++) {  // Only clear 4 streams
                if (activeStreams[i]) {
                    removeStream(i);
                }
            }
        }

        let isFocusMode = false;
        
        // Add event listener for the exit focus button
        document.addEventListener('DOMContentLoaded', () => {
            const exitFocusBtn = document.getElementById('exitFocusBtn');
            if (exitFocusBtn) {
                exitFocusBtn.addEventListener('click', toggleSidebar);
            }
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const videoGrid = document.getElementById('videoGrid');
            const bottomControls = document.querySelector('.bottom-controls');
            const sidebarToggle = document.getElementById('sidebarToggle');
            
            isFocusMode = !isFocusMode;
            
            if (isFocusMode) {
                // Enter focus mode
                sidebar.style.display = 'none';
                bottomControls.style.display = 'none';
                
                // Store current scroll position
                document.body.dataset.scrollX = window.scrollX;
                document.body.dataset.scrollY = window.scrollY;
                
                // Apply focus mode
                videoGrid.classList.add('focus-mode');
                sidebarToggle.textContent = 'Exit Focus';
                document.body.style.overflow = 'hidden';
                document.getElementById('exitFocusBtn').classList.add('visible');
                
                // Mute all videos and remove focus
                document.querySelectorAll('video').forEach(video => {
                    video.muted = true;
                });
                
                // Remove focus from any video container
                document.querySelectorAll('.video-container').forEach(container => {
                    container.classList.remove('focused');
                });
                
                // Update stream buttons to show no active stream
                document.querySelectorAll('.stream-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                // Reset focused stream
                focusedStream = -1;
            } else {
                // Exit focus mode
                videoGrid.classList.remove('focus-mode');
                
                // Restore sidebar and controls
                sidebar.style.display = 'block';
                sidebar.style.width = '280px';
                bottomControls.style.display = 'flex';
                
                // Restore scroll position
                window.scrollTo({
                    left: parseInt(document.body.dataset.scrollX || '0'),
                    top: parseInt(document.body.dataset.scrollY || '0'),
                    behavior: 'auto'
                });
                
                sidebarToggle.textContent = 'Focus Mode';
                document.body.style.overflow = '';
                document.getElementById('exitFocusBtn').classList.remove('visible');
            }
            
            // Update video sizes after layout change
            updateVideoSizes();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '6') {
                focusStream(parseInt(e.key) - 1);
            } else if (e.key === 'Escape') {
                // Exit PiP mode
                if (document.pictureInPictureElement) {
                    document.exitPictureInPicture();
                }
            }
        });

        // Search functionality
        const channelSearch = document.getElementById('channelSearch');
        const channelList = document.getElementById('channelList');
        let allChannelItems = [];
        
        // Store all channel items after they're created
        const originalPopulateChannelList = populateChannelList;
        populateChannelList = function() {
            originalPopulateChannelList();
            allChannelItems = Array.from(channelList.querySelectorAll('.channel-item'));
        };
        
        // Filter channels based on search input
        channelSearch.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            
            allChannelItems.forEach(item => {
                const channelName = item.textContent.toLowerCase();
                if (channelName.includes(searchTerm)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Handle dropdown items
            document.querySelectorAll('.channel-dropdown').forEach(dropdown => {
                const header = dropdown.querySelector('.channel-item');
                const items = dropdown.querySelectorAll('.dropdown-item');
                const hasVisibleItems = Array.from(items).some(item => 
                    item.textContent.toLowerCase().includes(searchTerm)
                );
                
                if (searchTerm === '' || hasVisibleItems || 
                    header.textContent.toLowerCase().includes(searchTerm)) {
                    dropdown.style.display = 'block';
                } else {
                    dropdown.style.display = 'none';
                }
            });
        });
        
        // Initialize the application when the page loads
        init();
    </script>
    <link rel="stylesheet" href="../navbar.css">
    <script src="../navbar.js"></script>
    <script src="../panicKey.js"></script>
    <script src="/checkAccess.js"></script>
<script src="tabCloak.js"></script>
<script>
    // Apply cloak on page load
    window.addEventListener('load', function() {
        const savedCloak = localStorage.getItem('tabCloak');
        if (savedCloak) {
            const cloak = JSON.parse(savedCloak);
            const existingFavicon = document.querySelector("link[rel*='icon']");
            if (existingFavicon) {
                existingFavicon.remove();
            }
            const newFavicon = document.createElement('link');
            newFavicon.rel = 'icon';
            newFavicon.type = 'image/x-icon';
            newFavicon.href = cloak.icon;
            document.head.appendChild(newFavicon);
            document.title = cloak.title;
        }
    });
</script>
</body>
</html>